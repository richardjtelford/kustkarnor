---
title: "Kustkarnor"
author: "Richard J. Telford"
date: "September 11, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-data}
loadd(fos_meta)
loadd(fos_percent)
```

```{r stratigraphies, results = "hide"}
fos_data <- fos_meta %>% 
  select(site, date) %>% 
  bind_cols(fos_percent) %>% 
  pivot_longer(cols = -(site:date), names_to = "taxon", values_to = "percent") %>% 
  group_by(site, taxon) %>% 
  filter(
    max(percent) >= 3, 
    sum(percent > 0) >= 3 
  ) %>% 
  group_by(site) %>% 
  nest() %>% 
  mutate(data = map(data, ~pivot_wider(.x, names_from = "taxon", values_from = "percent")))

map2(
  .x = fos_data$data,
  .y = fos_data$site,
  ~ strat.plot(
    d = select(.x, -date) %>% as.data.frame(),
    yvar = pull(.x, date),
    xLeft = 0.15,
    yBottom = .09,
    yTop = 0.7,
    xRight = 0.98,
    scale.percent = TRUE,
    title = .y
  ))
  
```

